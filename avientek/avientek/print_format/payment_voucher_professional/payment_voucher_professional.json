{
 "absolute_value": 0,
 "align_labels_right": 0,
 "creation": "2026-02-18 15:11:29.357359",
 "custom_format": 1,
 "default_print_language": "en",
 "disabled": 0,
 "doc_type": "Payment Request Form",
 "docstatus": 0,
 "doctype": "Print Format",
 "font_size": 0,
 "html": "{% set company_currency = frappe.db.get_value(\"Company\", doc.company, \"default_currency\") or \"AED\" %}\n{% set party_name = doc.party_name or doc.party %}\n\n{# Fetch payment history #}\n{% set payment_history = frappe.get_attr(\"avientek.avientek.doctype.payment_request_form.payment_request_form.get_supplier_payment_history\")(doc.party, doc.company, 10) or [] %}\n\n{# Get Previous Payment Details attachment from first row #}\n{% set first_row = doc.payment_references[0] if doc.payment_references else None %}\n{% set prev_payment_attachment = first_row.previous_payment_details if first_row else None %}\n{% set prev_payment_images = [] %}\n{% if prev_payment_attachment %}\n    {% set prev_payment_images = frappe.get_attr(\"avientek.avientek.doctype.payment_request_form.payment_request_form.get_attachment_as_images\")(prev_payment_attachment, 5) or [] %}\n{% endif %}\n\n{# Fetch supplier details #}\n{% set supplier_doc = frappe.get_doc(\"Supplier\", doc.party) if doc.party else {} %}\n{% set supplier_address = \"\" %}\n{% if supplier_doc and supplier_doc.supplier_primary_address %}\n    {% set addr = frappe.get_doc(\"Address\", supplier_doc.supplier_primary_address) %}\n    {% set supplier_address = [addr.address_line1 or \"\", addr.address_line2 or \"\", addr.city or \"\", addr.state or \"\", addr.country or \"\"]|select|join(\", \") %}\n{% endif %}\n\n{# Fetch supplier bank details with full info #}\n{% set supplier_bank = frappe.db.get_value(\"Bank Account\", {\"party_type\": \"Supplier\", \"party\": doc.party, \"is_default\": 1}, [\"name\", \"bank\", \"bank_account_no\", \"iban\", \"branch_code\"], as_dict=True) or {} %}\n{% set supplier_swift = \"\" %}\n{% if supplier_bank and supplier_bank.bank %}\n    {% set supplier_swift = frappe.db.get_value(\"Bank\", supplier_bank.bank, \"swift_number\") or \"\" %}\n{% endif %}\n\n{# Get issued bank details #}\n{% set issued_bank_details = frappe.db.get_value(\"Bank Account\", doc.issued_bank, [\"bank\", \"bank_account_no\", \"iban\"], as_dict=True) or {} %}\n{% set issued_bank_currency = frappe.db.get_value(\"Bank Account\", doc.issued_bank, \"account_currency\") or company_currency %}\n\n<style>\n    * {\n        box-sizing: border-box;\n    }\n\n    @page {\n        size: A4;\n        margin: 10mm;\n    }\n\n    html, body {\n        margin: 0;\n        padding: 0;\n    }\n\n    /* Hide ALL checkboxes and input elements */\n    input, input[type=\"checkbox\"], .checkbox, [type=\"checkbox\"] {\n        display: none !important;\n        visibility: hidden !important;\n        width: 0 !important;\n        height: 0 !important;\n        position: absolute !important;\n        left: -9999px !important;\n    }\n\n    .print-format-container input,\n    .print-format input {\n        display: none !important;\n    }\n\n    .print-format {\n        font-family: Arial, Helvetica, sans-serif;\n        font-size: 10pt;\n        color: #000;\n        line-height: 1.4;\n        padding: 0;\n        margin: 0;\n    }\n\n    .voucher-title {\n        text-align: center;\n        font-size: 16pt;\n        font-weight: bold;\n        border: 2px solid #000;\n        padding: 12px;\n        margin-bottom: 15px;\n    }\n\n    .company-row {\n        width: 100%;\n        border-collapse: collapse;\n        margin-bottom: 10px;\n    }\n\n    .company-row td.label {\n        background-color: #5b9bd5;\n        color: white;\n        font-weight: bold;\n        padding: 8px 15px;\n        width: 100px;\n        border: 1px solid #000;\n    }\n\n    .company-row td.value {\n        padding: 8px 15px;\n        border: 1px solid #000;\n        text-align: center;\n        font-weight: bold;\n    }\n\n    .details-row {\n        width: 100%;\n        border-collapse: collapse;\n        margin-bottom: 10px;\n    }\n\n    .details-row > tbody > tr > td {\n        vertical-align: top;\n        width: 50%;\n        padding: 0;\n    }\n\n    .details-row > tbody > tr > td:first-child {\n        padding-right: 5px;\n    }\n\n    .details-row > tbody > tr > td:last-child {\n        padding-left: 5px;\n    }\n\n    .section-box {\n        border: 1px solid #000;\n        width: 100%;\n    }\n\n    .section-header {\n        background-color: #5b9bd5;\n        color: white;\n        font-weight: bold;\n        padding: 6px 10px;\n        text-align: center;\n        font-size: 10pt;\n        border-bottom: 1px solid #000;\n    }\n\n    .section-content {\n        padding: 0;\n    }\n\n    .info-row {\n        display: table;\n        width: 100%;\n        border-bottom: 1px solid #000;\n    }\n\n    .info-row:last-child {\n        border-bottom: none;\n    }\n\n    .info-label {\n        display: table-cell;\n        width: 130px;\n        padding: 5px 8px;\n        vertical-align: top;\n        border-right: 1px solid #000;\n    }\n\n    .info-colon {\n        display: table-cell;\n        width: 15px;\n        padding: 5px 5px;\n        text-align: center;\n        border-right: 1px solid #000;\n    }\n\n    .info-value {\n        display: table-cell;\n        padding: 5px 8px;\n        vertical-align: top;\n    }\n\n    .section-title {\n        font-size: 11pt;\n        font-weight: bold;\n        margin: 15px 0 8px 0;\n        padding: 5px 0;\n        border-bottom: 1px solid #000;\n    }\n\n    .invoice-table {\n        width: 100%;\n        border-collapse: collapse;\n        margin-bottom: 15px;\n        font-size: 10pt;\n    }\n\n    .invoice-table th {\n        background-color: #5b9bd5;\n        color: white;\n        padding: 8px 5px;\n        text-align: center;\n        font-weight: bold;\n        border: 1px solid #000;\n    }\n\n    .invoice-table td {\n        padding: 6px 5px;\n        border: 1px solid #000;\n        vertical-align: middle;\n    }\n\n    .invoice-table .text-right {\n        text-align: right;\n    }\n\n    .invoice-table .text-center {\n        text-align: center;\n    }\n\n    .total-row {\n        font-weight: bold;\n    }\n\n    .debit-note-row td {\n        color: #000;\n    }\n\n    .payment-history-table {\n        width: 100%;\n        border-collapse: collapse;\n        margin-bottom: 15px;\n        font-size: 9pt;\n    }\n\n    .payment-history-table th {\n        background-color: #5b9bd5;\n        color: white;\n        padding: 6px 4px;\n        text-align: center;\n        font-weight: bold;\n        border: 1px solid #000;\n    }\n\n    .payment-history-table td {\n        padding: 5px 4px;\n        border: 1px solid #000;\n        text-align: center;\n    }\n\n    .signature-section {\n        margin-top: 30px;\n    }\n\n    .signature-table {\n        width: 100%;\n        border-collapse: collapse;\n    }\n\n    .signature-table td {\n        width: 50%;\n        padding: 30px 15px 10px 15px;\n        text-align: center;\n        border: 1px solid #000;\n        vertical-align: bottom;\n    }\n\n    .signature-line {\n        border-top: 1px solid #000;\n        margin: 0 20px;\n        padding-top: 5px;\n        font-size: 10pt;\n    }\n\n    .amount-negative {\n        color: #000;\n    }\n\n    .attachment-section {\n        page-break-before: always;\n    }\n\n    .attachment-header {\n        font-size: 11pt;\n        font-weight: bold;\n        margin: 10px 0;\n        padding: 5px 0;\n        border-bottom: 1px solid #000;\n    }\n\n    .pdf-page-image {\n        max-width: 100%;\n        height: auto;\n        display: block;\n        margin: 5px auto;\n        border: 1px solid #ccc;\n    }\n\n    .po-section {\n        page-break-before: always;\n    }\n\n    .po-header {\n        font-size: 11pt;\n        font-weight: bold;\n        margin: 10px 0;\n        padding: 5px 0;\n        border-bottom: 1px solid #000;\n    }\n\n    .costing-section {\n        page-break-before: always;\n    }\n\n    .costing-header {\n        font-size: 11pt;\n        font-weight: bold;\n        margin: 10px 0;\n        padding: 5px 0;\n        border-bottom: 1px solid #000;\n    }\n\n    .prev-payment-section {\n        page-break-before: always;\n    }\n\n    .prev-payment-header {\n        font-size: 11pt;\n        font-weight: bold;\n        margin: 10px 0;\n        padding: 5px 0;\n        border-bottom: 1px solid #000;\n    }\n</style>\n\n<div class=\"print-format\">\n\n    <!-- Payment Voucher Title -->\n    <div class=\"voucher-title\">PAYMENT VOUCHER</div>\n\n    <!-- Company Row -->\n    <table class=\"company-row\">\n        <tr>\n            <td class=\"label\">Company</td>\n            <td class=\"value\">{{ doc.company }}</td>\n        </tr>\n    </table>\n\n    <!-- Issued Bank Details & Voucher Details -->\n    <table class=\"details-row\">\n        <tr>\n            <td>\n                <div class=\"section-box\">\n                    <div class=\"section-header\">ISSUED BANK DETAILS</div>\n                    <div class=\"section-content\">\n                        <div class=\"info-row\">\n                            <span class=\"info-label\">Issued Bank</span>\n                            <span class=\"info-colon\">:</span>\n                            <span class=\"info-value\">{{ issued_bank_details.bank or doc.issued_bank or \"\" }}</span>\n                        </div>\n                        <div class=\"info-row\">\n                            <span class=\"info-label\">Account No.</span>\n                            <span class=\"info-colon\">:</span>\n                            <span class=\"info-value\">{{ issued_bank_details.bank_account_no or issued_bank_details.iban or \"\" }}</span>\n                        </div>\n                        <div class=\"info-row\">\n                            <span class=\"info-label\">Currency</span>\n                            <span class=\"info-colon\">:</span>\n                            <span class=\"info-value\">{{ issued_bank_currency }}</span>\n                        </div>\n                    </div>\n                </div>\n            </td>\n            <td>\n                <div class=\"section-box\">\n                    <div class=\"section-header\">VOUCHER DETAILS</div>\n                    <div class=\"section-content\">\n                        <div class=\"info-row\">\n                            <span class=\"info-label\">Voucher No.</span>\n                            <span class=\"info-colon\">:</span>\n                            <span class=\"info-value\">{{ doc.name }}</span>\n                        </div>\n                        <div class=\"info-row\">\n                            <span class=\"info-label\">Voucher Date</span>\n                            <span class=\"info-colon\">:</span>\n                            <span class=\"info-value\">{{ frappe.utils.formatdate(doc.posting_date, \"d-M-yyyy\") }}</span>\n                        </div>\n                        <div class=\"info-row\">\n                            <span class=\"info-label\">Payment Mode</span>\n                            <span class=\"info-colon\">:</span>\n                            <span class=\"info-value\">{{ doc.payment_mode or \"TR\" }}</span>\n                        </div>\n                        <div class=\"info-row\">\n                            <span class=\"info-label\">Cheque Date</span>\n                            <span class=\"info-colon\">:</span>\n                            <span class=\"info-value\">{{ frappe.utils.formatdate(doc.cheque_date, \"d-M-yyyy\") if doc.cheque_date else \"N/A\" }}</span>\n                        </div>\n                    </div>\n                </div>\n            </td>\n        </tr>\n    </table>\n\n    <!-- Supplier Details & Bank Details -->\n    <table class=\"details-row\">\n        <tr>\n            <td>\n                <div class=\"section-box\">\n                    <div class=\"section-header\">SUPPLIER DETAILS</div>\n                    <div class=\"section-content\">\n                        <div class=\"info-row\">\n                            <span class=\"info-label\">Supplier Name</span>\n                            <span class=\"info-colon\">:</span>\n                            <span class=\"info-value\">{{ party_name }}</span>\n                        </div>\n                        <div class=\"info-row\">\n                            <span class=\"info-label\">Supplier Address</span>\n                            <span class=\"info-colon\">:</span>\n                            <span class=\"info-value\">{{ supplier_address or doc.supplier_address or \"\" }}</span>\n                        </div>\n                        <div class=\"info-row\">\n                            <span class=\"info-label\">Telephone</span>\n                            <span class=\"info-colon\">:</span>\n                            <span class=\"info-value\">{{ supplier_doc.mobile_no or supplier_doc.phone_no or \"\" }}</span>\n                        </div>\n                        <div class=\"info-row\">\n                            <span class=\"info-label\">E-Mail</span>\n                            <span class=\"info-colon\">:</span>\n                            <span class=\"info-value\">{{ supplier_doc.email_id or \"\" }}</span>\n                        </div>\n                    </div>\n                </div>\n            </td>\n            <td>\n                <div class=\"section-box\">\n                    <div class=\"section-header\">BANK DETAILS (for TT/ TR Payments)</div>\n                    <div class=\"section-content\">\n                        <div class=\"info-row\">\n                            <span class=\"info-label\">Bank Account No.</span>\n                            <span class=\"info-colon\">:</span>\n                            <span class=\"info-value\">{{ supplier_bank.bank_account_no or supplier_bank.iban or \"\" }}</span>\n                        </div>\n                        <div class=\"info-row\">\n                            <span class=\"info-label\">Bank Account Name</span>\n                            <span class=\"info-colon\">:</span>\n                            <span class=\"info-value\">{{ supplier_bank.name or \"\" }}</span>\n                        </div>\n                        <div class=\"info-row\">\n                            <span class=\"info-label\">Bank Name</span>\n                            <span class=\"info-colon\">:</span>\n                            <span class=\"info-value\">{{ supplier_bank.bank or \"\" }}</span>\n                        </div>\n                        <div class=\"info-row\">\n                            <span class=\"info-label\">SWIFT Code</span>\n                            <span class=\"info-colon\">:</span>\n                            <span class=\"info-value\">{{ supplier_swift }}</span>\n                        </div>\n                    </div>\n                </div>\n            </td>\n        </tr>\n    </table>\n\n    <!-- Invoice Summary Section -->\n    <div class=\"section-title\">Invoice Details</div>\n\n    <table class=\"invoice-table\">\n        <thead>\n            <tr>\n                <th style=\"width: 40px;\">SINo</th>\n                <th style=\"width: 140px;\">Inv. No.</th>\n                <th style=\"width: 85px;\">Inv. Date</th>\n                <th style=\"width: 50px;\">Curr.</th>\n                <th style=\"width: 100px;\">Amount (FC)</th>\n                <th style=\"width: 100px;\">Amount ({{ company_currency }})</th>\n                <th>Details / Remarks</th>\n            </tr>\n        </thead>\n        <tbody>\n            {% set total_base = {'value': 0} %}\n            {% set currency_totals = {} %}\n\n            {% for row in doc.payment_references %}\n            {% set is_debit = row.is_return or row.reference_doctype == \"Debit Note\" %}\n            {% set amount_fc = row.outstanding_amount or row.grand_total or 0 %}\n            {% set amount_base = row.base_outstanding_amount or row.base_grand_total or 0 %}\n\n            {% set curr = row.currency or company_currency %}\n            {% if curr not in currency_totals %}\n                {% set _ = currency_totals.update({curr: {'fc': 0, 'base': 0}}) %}\n            {% endif %}\n            {% set _ = currency_totals[curr].update({'fc': currency_totals[curr]['fc'] + amount_fc}) %}\n            {% set _ = total_base.update({'value': total_base['value'] + amount_base}) %}\n\n            <tr class=\"{{ 'debit-note-row' if is_debit else '' }}\">\n                <td class=\"text-center\">{{ loop.index }}</td>\n                <td>{{ row.reference_name }}</td>\n                <td class=\"text-center\">{{ frappe.utils.formatdate(row.invoice_date, \"dd-MM-yyyy\") if row.invoice_date else \"\" }}</td>\n                <td class=\"text-center\">{{ row.currency or company_currency }}</td>\n                <td class=\"text-right {{ 'amount-negative' if is_debit else '' }}\">\n                    {{ frappe.utils.fmt_money(amount_fc, currency=row.currency) }}\n                </td>\n                <td class=\"text-right {{ 'amount-negative' if is_debit else '' }}\">\n                    {{ frappe.utils.fmt_money(amount_base, currency=company_currency) }}\n                </td>\n                <td>{{ row.document_reference or row.remarks or \"\" }}</td>\n            </tr>\n            {% endfor %}\n\n            <tr class=\"total-row\">\n                <td colspan=\"4\" class=\"text-center\"><strong>TOTAL</strong></td>\n                <td class=\"text-right\">\n                    {% for curr, amounts in currency_totals.items() %}\n                    {{ frappe.utils.fmt_money(amounts['fc'], currency=curr) }}{% if not loop.last %}<br>{% endif %}\n                    {% endfor %}\n                </td>\n                <td class=\"text-right\">{{ frappe.utils.fmt_money(total_base['value'], currency=company_currency) }}</td>\n                <td></td>\n            </tr>\n        </tbody>\n    </table>\n\n    <!-- Previous Payment Details Section (Table) -->\n    {% if payment_history and payment_history|length > 0 %}\n    <div class=\"section-title\">Previous Payment Details</div>\n\n    <table class=\"payment-history-table\">\n        <thead>\n            <tr>\n                <th style=\"width: 30px;\">Sl.</th>\n                <th style=\"width: 75px;\">Bank</th>\n                <th style=\"width: 35px;\">Type</th>\n                <th style=\"width: 110px;\">Voucher No.</th>\n                <th style=\"width: 75px;\">Date</th>\n                <th style=\"width: 100px;\">Beneficiary</th>\n                <th style=\"width: 105px;\">IBAN/Account</th>\n                <th style=\"width: 85px;\">Debit Account</th>\n                <th style=\"width: 40px;\">Curr.</th>\n                <th style=\"width: 85px;\">Amount</th>\n            </tr>\n        </thead>\n        <tbody>\n            {% for payment in payment_history[:10] %}\n            <tr>\n                <td>{{ loop.index }}</td>\n                <td style=\"text-align: left; padding-left: 5px;\">{{ payment.bank or \"\" }}</td>\n                <td>{{ payment.type or \"TR\" }}</td>\n                <td style=\"text-align: left; padding-left: 5px;\">{{ payment.voucher_no or \"\" }}</td>\n                <td>{{ frappe.utils.formatdate(payment.date, \"dd-MM-yyyy\") if payment.date else \"\" }}</td>\n                <td style=\"text-align: left; padding-left: 5px;\">{{ payment.beneficiary or \"\" }}</td>\n                <td style=\"text-align: left; padding-left: 5px; font-size: 8pt;\">{{ payment.beneficiary_account or \"\" }}</td>\n                <td style=\"text-align: left; padding-left: 5px; font-size: 8pt;\">{{ payment.debit_account or \"\" }}</td>\n                <td>{{ payment.currency or company_currency }}</td>\n                <td style=\"text-align: right;\">{{ frappe.utils.fmt_money(payment.amount, currency=payment.currency) }}</td>\n            </tr>\n            {% endfor %}\n        </tbody>\n    </table>\n    {% endif %}\n\n    <!-- Previous Payment Details Attachment (from first row) - shown after table or in place of it -->\n    {% if prev_payment_images|length > 0 %}\n    <div class=\"prev-payment-section\">\n        <div class=\"prev-payment-header\">Previous Payment Details (Attachment)</div>\n        {% for img_data in prev_payment_images %}\n            <img src=\"{{ img_data }}\" class=\"pdf-page-image\" />\n        {% endfor %}\n    </div>\n    {% endif %}\n\n    <!-- Remarks Section -->\n    {% if doc.remarks %}\n    <div class=\"section-title\">Remarks</div>\n    <div style=\"padding: 10px; border: 1px solid #000; font-size: 10pt;\">\n        {{ doc.remarks }}\n    </div>\n    {% endif %}\n\n    <!-- Signature Section -->\n    <div class=\"signature-section\">\n        <table class=\"signature-table\">\n            <tr>\n                <td>\n                    <div class=\"signature-line\">Prepared by / Authorized by: ACCOUNTS MANAGER</div>\n                </td>\n                <td>\n                    <div class=\"signature-line\">Approved by: FINANCE MANAGER</div>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <div class=\"signature-line\">Approved by: GENERAL MANAGER</div>\n                </td>\n                <td>\n                    <div class=\"signature-line\">Approved by: MANAGING DIRECTOR</div>\n                </td>\n            </tr>\n        </table>\n    </div>\n\n    <!-- Supplier Invoice Attachments, Purchase Orders, and Costing Sheets Section -->\n    {% for row in doc.payment_references %}\n        {% if row.reference_doctype == \"Purchase Invoice\" %}\n            {% set pdf_images = frappe.get_attr(\"avientek.avientek.doctype.payment_request_form.payment_request_form.get_invoice_attachment_images\")(row.reference_name, 5) or [] %}\n            {% set linked_po = frappe.get_attr(\"avientek.avientek.doctype.payment_request_form.payment_request_form.get_linked_po_for_invoice\")(row.reference_name) %}\n            {% set po_images = [] %}\n            {% if linked_po %}\n                {% set po_images = frappe.get_attr(\"avientek.avientek.doctype.payment_request_form.payment_request_form.get_print_format_as_images\")(\"Purchase Order\", linked_po, \"Purchase Order - India\", 5) or [] %}\n            {% endif %}\n            \n            {# Get costing sheet attachment for this row #}\n            {% set costing_images = [] %}\n            {% if row.costing_sheet_attachment %}\n                {% set costing_images = frappe.get_attr(\"avientek.avientek.doctype.payment_request_form.payment_request_form.get_attachment_as_images\")(row.costing_sheet_attachment, 5) or [] %}\n            {% endif %}\n\n            {% if pdf_images|length > 0 %}\n            <div class=\"attachment-section\">\n                <div class=\"attachment-header\">Supplier Invoice: {{ row.reference_name }}</div>\n                {% for img_data in pdf_images %}\n                    <img src=\"{{ img_data }}\" class=\"pdf-page-image\" />\n                {% endfor %}\n            </div>\n            {% endif %}\n\n            {% if po_images|length > 0 %}\n            <div class=\"po-section\">\n                <div class=\"po-header\">Purchase Order: {{ linked_po }}</div>\n                {% for img_data in po_images %}\n                    <img src=\"{{ img_data }}\" class=\"pdf-page-image\" />\n                {% endfor %}\n            </div>\n            {% endif %}\n\n            {# Costing Sheet after PO #}\n            {% if costing_images|length > 0 %}\n            <div class=\"costing-section\">\n                <div class=\"costing-header\">Costing Sheet: {{ row.reference_name }}</div>\n                {% for img_data in costing_images %}\n                    <img src=\"{{ img_data }}\" class=\"pdf-page-image\" />\n                {% endfor %}\n            </div>\n            {% endif %}\n        {% endif %}\n    {% endfor %}\n</div>\n",
 "idx": 0,
 "line_breaks": 0,
 "margin_bottom": 10.0,
 "margin_left": 10.0,
 "margin_right": 10.0,
 "margin_top": 10.0,
 "modified": "2026-02-19 13:52:23.912157",
 "modified_by": "Administrator",
 "module": "Avientek",
 "name": "Payment Voucher Professional",
 "owner": "Administrator",
 "print_format_builder": 0,
 "print_format_builder_beta": 0,
 "print_format_for": "DocType",
 "print_format_type": "Jinja",
 "raw_printing": 0,
 "show_section_headings": 0,
 "standard": "Yes"
}