{
 "absolute_value": 0,
 "align_labels_right": 0,
 "creation": "2026-02-18 15:11:29.357359",
 "custom_format": 1,
 "default_print_language": "en",
 "disabled": 0,
 "doc_type": "Payment Request Form",
 "docstatus": 0,
 "doctype": "Print Format",
 "font_size": 0,
 "html": "{% set company_currency = frappe.db.get_value(\"Company\", doc.company, \"default_currency\") or \"AED\" %}\n{% set party_name = doc.party_name or doc.party %}\n\n{# Fetch payment history #}\n{% set payment_history = frappe.call(\"avientek.avientek.doctype.payment_request_form.payment_request_form.get_supplier_payment_history\", supplier=doc.party, company=doc.company, limit=10) or [] %}\n\n{# Fetch supplier bank details #}\n{% set supplier_bank = frappe.db.get_value(\"Bank Account\", {\"party_type\": \"Supplier\", \"party\": doc.party, \"is_default\": 1}, [\"bank\", \"bank_account_no\", \"iban\", \"branch_code\"], as_dict=True) or {} %}\n\n{# Get issued bank details #}\n{% set issued_bank_details = frappe.db.get_value(\"Bank Account\", doc.issued_bank, [\"bank\", \"bank_account_no\", \"iban\"], as_dict=True) or {} %}\n\n<style>\n    @page {\n        size: A4;\n        margin: 15mm 10mm 15mm 10mm;\n    }\n\n    .print-format {\n        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n        font-size: 10pt;\n        color: #333;\n        line-height: 1.4;\n    }\n\n    .header-section {\n        border-bottom: 2px solid #1a4d7c;\n        padding-bottom: 15px;\n        margin-bottom: 20px;\n    }\n\n    .company-name {\n        font-size: 18pt;\n        font-weight: bold;\n        color: #1a4d7c;\n        margin-bottom: 5px;\n    }\n\n    .document-title {\n        font-size: 14pt;\n        font-weight: bold;\n        color: #1a4d7c;\n        text-align: center;\n        margin: 15px 0;\n        padding: 8px;\n        background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%);\n        border-radius: 4px;\n    }\n\n    .info-table {\n        width: 100%;\n        margin-bottom: 15px;\n        border-collapse: collapse;\n    }\n\n    .info-table td {\n        padding: 5px 8px;\n        vertical-align: top;\n    }\n\n    .info-label {\n        font-weight: 600;\n        color: #555;\n        width: 140px;\n    }\n\n    .info-value {\n        color: #333;\n    }\n\n    .section-title {\n        font-size: 11pt;\n        font-weight: bold;\n        color: #1a4d7c;\n        margin: 20px 0 10px 0;\n        padding: 6px 10px;\n        background-color: #e8f0f7;\n        border-left: 4px solid #1a4d7c;\n    }\n\n    .invoice-table {\n        width: 100%;\n        border-collapse: collapse;\n        margin-bottom: 15px;\n        font-size: 9pt;\n    }\n\n    .invoice-table th {\n        background-color: #1a4d7c;\n        color: white;\n        padding: 8px 6px;\n        text-align: center;\n        font-weight: 600;\n        border: 1px solid #1a4d7c;\n    }\n\n    .invoice-table td {\n        padding: 6px;\n        border: 1px solid #ddd;\n        vertical-align: middle;\n    }\n\n    .invoice-table tr:nth-child(even) {\n        background-color: #f9f9f9;\n    }\n\n    .invoice-table .text-right {\n        text-align: right;\n    }\n\n    .invoice-table .text-center {\n        text-align: center;\n    }\n\n    .total-row {\n        background-color: #1a4d7c !important;\n        color: white;\n        font-weight: bold;\n    }\n\n    .total-row td {\n        border-color: #1a4d7c !important;\n        padding: 8px 6px;\n    }\n\n    .debit-note-row {\n        background-color: #fff5f5 !important;\n    }\n\n    .debit-note-row td {\n        color: #c0392b;\n    }\n\n    .payment-history-table {\n        width: 100%;\n        border-collapse: collapse;\n        margin-bottom: 15px;\n        font-size: 8pt;\n    }\n\n    .payment-history-table th {\n        background-color: #34495e;\n        color: white;\n        padding: 6px 4px;\n        text-align: center;\n        font-weight: 600;\n        border: 1px solid #34495e;\n    }\n\n    .payment-history-table td {\n        padding: 4px;\n        border: 1px solid #ddd;\n        text-align: center;\n    }\n\n    .payment-history-table tr:nth-child(even) {\n        background-color: #f5f5f5;\n    }\n\n    .signature-section {\n        margin-top: 40px;\n        page-break-inside: avoid;\n    }\n\n    .signature-table {\n        width: 100%;\n        border-collapse: collapse;\n    }\n\n    .signature-table td {\n        width: 50%;\n        padding: 30px 15px 10px 15px;\n        text-align: center;\n        border: 1px solid #ccc;\n        vertical-align: bottom;\n    }\n\n    .signature-line {\n        border-top: 1px solid #333;\n        margin: 0 20px;\n        padding-top: 5px;\n        font-size: 9pt;\n        color: #555;\n    }\n\n    .amount-negative {\n        color: #c0392b;\n    }\n\n    .attachment-section {\n        margin-top: 25px;\n        page-break-before: always;\n    }\n\n    .attachment-container {\n        margin-bottom: 20px;\n        border: 1px solid #ddd;\n        border-radius: 4px;\n        overflow: hidden;\n    }\n\n    .attachment-header {\n        background-color: #f5f7fa;\n        padding: 8px 12px;\n        font-weight: 600;\n        color: #1a4d7c;\n        border-bottom: 1px solid #ddd;\n        font-size: 9pt;\n    }\n\n    .attachment-content {\n        padding: 10px;\n        background-color: #fff;\n    }\n\n    .attachment-image {\n        max-width: 100%;\n        height: auto;\n        display: block;\n        margin: 10px auto;\n        border: 1px solid #eee;\n    }\n\n    .pdf-page-image {\n        max-width: 100%;\n        height: auto;\n        display: block;\n        margin: 10px auto;\n        border: 1px solid #ccc;\n        box-shadow: 0 2px 5px rgba(0,0,0,0.1);\n    }\n\n    .po-section {\n        margin-top: 20px;\n        page-break-before: always;\n    }\n\n    .po-header {\n        background-color: #2c3e50;\n        color: white;\n        padding: 8px 12px;\n        font-weight: 600;\n        font-size: 10pt;\n        border-radius: 4px 4px 0 0;\n    }\n\n    .po-content {\n        border: 1px solid #ddd;\n        border-top: none;\n        padding: 10px;\n        background-color: #fff;\n    }\n\n    .page-break {\n        page-break-after: always;\n    }\n\n    .attachment-list {\n        list-style: none;\n        padding: 0;\n        margin: 0;\n    }\n\n    .attachment-list li {\n        padding: 5px 0;\n        border-bottom: 1px solid #f0f0f0;\n        font-size: 9pt;\n    }\n\n    .attachment-list li:last-child {\n        border-bottom: none;\n    }\n\n    .attachment-icon {\n        display: inline-block;\n        width: 16px;\n        margin-right: 5px;\n        color: #1a4d7c;\n    }\n</style>\n\n<div class=\"print-format\">\n    <!-- Header Section -->\n    <div class=\"header-section\">\n        <table style=\"width: 100%;\">\n            <tr>\n                <td style=\"width: 70%;\">\n                    <div class=\"company-name\">{{ doc.company }}</div>\n                </td>\n                <td style=\"width: 30%; text-align: right;\">\n                    <div style=\"font-size: 9pt;\">\n                        <strong>Date:</strong> {{ frappe.utils.formatdate(doc.posting_date, \"dd-MM-yyyy\") }}<br>\n                        <strong>Voucher No:</strong> {{ doc.name }}\n                    </div>\n                </td>\n            </tr>\n        </table>\n    </div>\n\n    <div class=\"document-title\">PAYMENT VOUCHER</div>\n\n    <!-- Beneficiary Information -->\n    <table class=\"info-table\">\n        <tr>\n            <td class=\"info-label\">Beneficiary:</td>\n            <td class=\"info-value\" style=\"width: 35%;\">{{ party_name }}</td>\n            <td class=\"info-label\">Department:</td>\n            <td class=\"info-value\">{{ doc.department or \"\" }}</td>\n        </tr>\n        <tr>\n            <td class=\"info-label\">Bank:</td>\n            <td class=\"info-value\">{{ supplier_bank.bank or \"\" }}</td>\n            <td class=\"info-label\">Payment Mode:</td>\n            <td class=\"info-value\">{{ doc.payment_mode or \"\" }}</td>\n        </tr>\n        <tr>\n            <td class=\"info-label\">Account No / IBAN:</td>\n            <td class=\"info-value\">{{ supplier_bank.iban or supplier_bank.bank_account_no or \"\" }}</td>\n            <td class=\"info-label\">Issued Bank:</td>\n            <td class=\"info-value\">{{ issued_bank_details.bank or doc.issued_bank or \"\" }}</td>\n        </tr>\n    </table>\n\n    <!-- Invoice Summary Section -->\n    <div class=\"section-title\">Invoice Details</div>\n\n    <table class=\"invoice-table\">\n        <thead>\n            <tr>\n                <th style=\"width: 35px;\">SINo</th>\n                <th style=\"width: 130px;\">Inv. No.</th>\n                <th style=\"width: 80px;\">Inv. Date</th>\n                <th style=\"width: 45px;\">Curr.</th>\n                <th style=\"width: 100px;\">Amount (FC)</th>\n                <th style=\"width: 100px;\">Amount ({{ company_currency }})</th>\n                <th>Details / Remarks</th>\n            </tr>\n        </thead>\n        <tbody>\n            {% set total_base = {'value': 0} %}\n            {% set currency_totals = {} %}\n\n            {% for row in doc.payment_references %}\n            {% set is_debit = row.is_return or row.reference_doctype == \"Debit Note\" %}\n            {% set amount_fc = row.outstanding_amount or row.grand_total or 0 %}\n            {% set amount_base = row.base_outstanding_amount or row.base_grand_total or 0 %}\n\n            {% set curr = row.currency or company_currency %}\n            {% if curr not in currency_totals %}\n                {% set _ = currency_totals.update({curr: {'fc': 0, 'base': 0}}) %}\n            {% endif %}\n            {% set _ = currency_totals[curr].update({'fc': currency_totals[curr]['fc'] + amount_fc}) %}\n            {% set _ = total_base.update({'value': total_base['value'] + amount_base}) %}\n\n            <tr class=\"{{ 'debit-note-row' if is_debit else '' }}\">\n                <td class=\"text-center\">{{ loop.index }}</td>\n                <td>{{ row.reference_name }}</td>\n                <td class=\"text-center\">{{ frappe.utils.formatdate(row.invoice_date, \"dd-MM-yyyy\") if row.invoice_date else \"\" }}</td>\n                <td class=\"text-center\">{{ row.currency or company_currency }}</td>\n                <td class=\"text-right {{ 'amount-negative' if is_debit else '' }}\">\n                    {{ frappe.utils.fmt_money(amount_fc, currency=row.currency) }}\n                </td>\n                <td class=\"text-right {{ 'amount-negative' if is_debit else '' }}\">\n                    {{ frappe.utils.fmt_money(amount_base, currency=company_currency) }}\n                </td>\n                <td>{{ row.document_reference or row.remarks or \"\" }}</td>\n            </tr>\n            {% endfor %}\n\n            <tr class=\"total-row\">\n                <td colspan=\"4\" class=\"text-center\"><strong>TOTAL</strong></td>\n                <td class=\"text-right\">\n                    {% for curr, amounts in currency_totals.items() %}\n                    {{ frappe.utils.fmt_money(amounts['fc'], currency=curr) }}{% if not loop.last %}<br>{% endif %}\n                    {% endfor %}\n                </td>\n                <td class=\"text-right\">{{ frappe.utils.fmt_money(total_base['value'], currency=company_currency) }}</td>\n                <td></td>\n            </tr>\n        </tbody>\n    </table>\n\n    <!-- Previous Payment Details Section -->\n    {% if payment_history and payment_history|length > 0 %}\n    <div class=\"section-title\">Previous Payment Details</div>\n\n    <table class=\"payment-history-table\">\n        <thead>\n            <tr>\n                <th style=\"width: 30px;\">Sl.</th>\n                <th style=\"width: 80px;\">Bank</th>\n                <th style=\"width: 30px;\">Type</th>\n                <th style=\"width: 100px;\">Voucher No.</th>\n                <th style=\"width: 70px;\">Date</th>\n                <th style=\"width: 100px;\">Beneficiary</th>\n                <th style=\"width: 100px;\">IBAN/Account</th>\n                <th style=\"width: 80px;\">Debit Account</th>\n                <th style=\"width: 35px;\">Curr.</th>\n                <th style=\"width: 80px;\">Amount</th>\n            </tr>\n        </thead>\n        <tbody>\n            {% for payment in payment_history[:10] %}\n            <tr>\n                <td>{{ loop.index }}</td>\n                <td style=\"text-align: left; padding-left: 5px;\">{{ payment.bank or \"\" }}</td>\n                <td>{{ payment.type or \"TR\" }}</td>\n                <td style=\"text-align: left; padding-left: 5px;\">{{ payment.voucher_no or \"\" }}</td>\n                <td>{{ frappe.utils.formatdate(payment.date, \"dd-MM-yyyy\") if payment.date else \"\" }}</td>\n                <td style=\"text-align: left; padding-left: 5px;\">{{ payment.beneficiary or \"\" }}</td>\n                <td style=\"text-align: left; padding-left: 5px; font-size: 7pt;\">{{ payment.beneficiary_account or \"\" }}</td>\n                <td style=\"text-align: left; padding-left: 5px; font-size: 7pt;\">{{ payment.debit_account or \"\" }}</td>\n                <td>{{ payment.currency or company_currency }}</td>\n                <td style=\"text-align: right;\">{{ frappe.utils.fmt_money(payment.amount, currency=payment.currency) }}</td>\n            </tr>\n            {% endfor %}\n        </tbody>\n    </table>\n    {% endif %}\n\n    <!-- Remarks Section -->\n    {% if doc.remarks %}\n    <div class=\"section-title\">Remarks</div>\n    <div style=\"padding: 8px; background-color: #f9f9f9; border: 1px solid #eee; border-radius: 4px;\">\n        {{ doc.remarks }}\n    </div>\n    {% endif %}\n\n    <!-- Signature Section -->\n    <div class=\"signature-section\">\n        <table class=\"signature-table\">\n            <tr>\n                <td>\n                    <div class=\"signature-line\">Prepared by / Authorized by: ACCOUNTS MANAGER</div>\n                </td>\n                <td>\n                    <div class=\"signature-line\">Approved by: FINANCE MANAGER</div>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <div class=\"signature-line\">Approved by: GENERAL MANAGER</div>\n                </td>\n                <td>\n                    <div class=\"signature-line\">Approved by: MANAGING DIRECTOR</div>\n                </td>\n            </tr>\n        </table>\n    </div>\n\n    <!-- Supplier Invoice Attachments and Purchase Orders Section -->\n    {% for row in doc.payment_references %}\n        {% if row.reference_doctype == \"Purchase Invoice\" %}\n            {# Get PDF images from supplier invoice attachment #}\n            {% set pdf_images = frappe.call(\"avientek.avientek.doctype.payment_request_form.payment_request_form.get_invoice_attachment_images\", invoice_name=row.reference_name, max_pages=5) or [] %}\n\n            {# Get linked Purchase Order #}\n            {% set linked_po = frappe.call(\"avientek.avientek.doctype.payment_request_form.payment_request_form.get_linked_po_for_invoice\", invoice_name=row.reference_name) %}\n\n            {# Get Purchase Order print format as images #}\n            {% set po_images = [] %}\n            {% if linked_po %}\n                {% set po_images = frappe.call(\"avientek.avientek.doctype.payment_request_form.payment_request_form.get_print_format_as_images\", doctype=\"Purchase Order\", docname=linked_po, print_format=\"Purchase Order - India\", max_pages=5) or [] %}\n            {% endif %}\n\n            {# Only show section if there are attachments or PO #}\n            {% if pdf_images|length > 0 or po_images|length > 0 %}\n\n            <!-- Supplier Invoice Attachment -->\n            {% if pdf_images|length > 0 %}\n            <div class=\"attachment-section\">\n                <div class=\"section-title\">Supplier Invoice: {{ row.reference_name }}</div>\n                <div class=\"attachment-content\">\n                    {% for img_data in pdf_images %}\n                        <img src=\"{{ img_data }}\" class=\"pdf-page-image\" alt=\"Supplier Invoice Page\" />\n                    {% endfor %}\n                </div>\n            </div>\n            {% endif %}\n\n            <!-- Purchase Order -->\n            {% if po_images|length > 0 %}\n            <div class=\"po-section\">\n                <div class=\"po-header\">Purchase Order: {{ linked_po }}</div>\n                <div class=\"po-content\">\n                    {% for img_data in po_images %}\n                        <img src=\"{{ img_data }}\" class=\"pdf-page-image\" alt=\"Purchase Order Page\" />\n                    {% endfor %}\n                </div>\n            </div>\n            {% endif %}\n\n            {% endif %}\n        {% endif %}\n    {% endfor %}\n</div>\n",
 "idx": 0,
 "line_breaks": 0,
 "margin_bottom": 0.0,
 "margin_left": 0.0,
 "margin_right": 0.0,
 "margin_top": 0.0,
 "modified": "2026-02-18 16:30:00.000000",
 "modified_by": "Administrator",
 "module": "Avientek",
 "name": "Payment Voucher Professional",
 "owner": "Administrator",
 "print_format_builder": 0,
 "print_format_builder_beta": 0,
 "print_format_type": "Jinja",
 "raw_printing": 0,
 "show_section_headings": 0,
 "standard": "Yes"
}
