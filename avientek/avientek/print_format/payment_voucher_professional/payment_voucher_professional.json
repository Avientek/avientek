{
 "absolute_value": 0,
 "align_labels_right": 0,
 "creation": "2026-02-18 15:11:29.357359",
 "custom_format": 1,
 "default_print_language": "en",
 "disabled": 0,
 "doc_type": "Payment Request Form",
 "docstatus": 0,
 "doctype": "Print Format",
 "font_size": 0,
 "html": "{% set company_currency = frappe.db.get_value(\"Company\", doc.company, \"default_currency\") or \"AED\" %}\n{% set party_name = doc.party_name or doc.party %}\n\n{# Fetch payment history #}\n{% set payment_history = frappe.call(\"avientek.avientek.doctype.payment_request_form.payment_request_form.get_supplier_payment_history\", supplier=doc.party, company=doc.company, limit=10) or [] %}\n\n{# Fetch supplier details #}\n{% set supplier_doc = frappe.get_doc(\"Supplier\", doc.party) if doc.party else {} %}\n{% set supplier_address = \"\" %}\n{% if supplier_doc and supplier_doc.supplier_primary_address %}\n    {% set addr = frappe.get_doc(\"Address\", supplier_doc.supplier_primary_address) %}\n    {% set supplier_address = [addr.address_line1 or \"\", addr.address_line2 or \"\", addr.city or \"\", addr.state or \"\", addr.country or \"\"]|select|join(\", \") %}\n{% endif %}\n\n{# Fetch supplier bank details with full info #}\n{% set supplier_bank = frappe.db.get_value(\"Bank Account\", {\"party_type\": \"Supplier\", \"party\": doc.party, \"is_default\": 1}, [\"name\", \"bank\", \"bank_account_no\", \"iban\", \"branch_code\"], as_dict=True) or {} %}\n{% set supplier_swift = \"\" %}\n{% if supplier_bank and supplier_bank.bank %}\n    {% set supplier_swift = frappe.db.get_value(\"Bank\", supplier_bank.bank, \"swift_number\") or \"\" %}\n{% endif %}\n\n{# Get issued bank details #}\n{% set issued_bank_details = frappe.db.get_value(\"Bank Account\", doc.issued_bank, [\"bank\", \"bank_account_no\", \"iban\"], as_dict=True) or {} %}\n{% set issued_bank_currency = frappe.db.get_value(\"Bank Account\", doc.issued_bank, \"account_currency\") or company_currency %}\n\n<style>\n    @page {\n        size: A4;\n        margin: 15mm 10mm 20mm 10mm;\n        @top-center {\n            content: element(header);\n        }\n        @bottom-center {\n            content: element(footer);\n        }\n    }\n\n    html, body {\n        margin: 0;\n        padding: 0;\n    }\n\n    .print-format {\n        font-family: Arial, Helvetica, sans-serif;\n        font-size: 9pt;\n        color: #333;\n        line-height: 1.3;\n        padding: 0;\n        margin: 0;\n    }\n\n    /* Header and Footer Styling */\n    .letter-head-container {\n        position: running(header);\n        width: 100%;\n        margin-bottom: 10px;\n    }\n\n    .letter-head {\n        width: 100%;\n        text-align: center;\n    }\n\n    .letter-head img {\n        max-width: 100%;\n        max-height: 80px;\n    }\n\n    .letter-footer-container {\n        position: running(footer);\n        width: 100%;\n        margin-top: 10px;\n        padding-top: 5px;\n        border-top: 1px solid #ccc;\n    }\n\n    .letter-footer {\n        width: 100%;\n        text-align: center;\n        font-size: 8pt;\n        color: #666;\n    }\n\n    .voucher-title {\n        text-align: center;\n        font-size: 14pt;\n        font-weight: bold;\n        border: 2px solid #333;\n        padding: 8px;\n        margin-bottom: 10px;\n        background-color: #fff;\n    }\n\n    .company-row {\n        width: 100%;\n        border-collapse: collapse;\n        margin-bottom: 0;\n    }\n\n    .company-row td.label {\n        background-color: #5b9bd5;\n        color: white;\n        font-weight: bold;\n        padding: 6px 10px;\n        width: 100px;\n        border: 1px solid #333;\n    }\n\n    .company-row td.value {\n        padding: 6px 10px;\n        border: 1px solid #333;\n        text-align: center;\n        font-weight: bold;\n    }\n\n    .details-container {\n        width: 100%;\n        border-collapse: collapse;\n        table-layout: fixed;\n    }\n\n    .details-container > tbody > tr > td {\n        vertical-align: top;\n        width: 50%;\n        padding: 0;\n    }\n\n    .section-header {\n        background-color: #5b9bd5;\n        color: white;\n        font-weight: bold;\n        padding: 5px 8px;\n        text-align: center;\n        border: 1px solid #333;\n        font-size: 8pt;\n    }\n\n    .details-table {\n        width: 100%;\n        border-collapse: collapse;\n    }\n\n    .details-table td {\n        padding: 3px 6px;\n        border: 1px solid #333;\n        font-size: 8pt;\n        vertical-align: middle;\n    }\n\n    .details-table td.label {\n        width: 100px;\n        font-weight: normal;\n        background-color: #f8f9fa;\n    }\n\n    .details-table td.value {\n        font-weight: normal;\n    }\n\n    .details-table td.colon {\n        width: 8px;\n        text-align: center;\n        padding: 3px 2px;\n    }\n\n    .section-title {\n        font-size: 10pt;\n        font-weight: bold;\n        color: #1a4d7c;\n        margin: 12px 0 6px 0;\n        padding: 4px 8px;\n        background-color: #e8f0f7;\n        border-left: 4px solid #1a4d7c;\n    }\n\n    .invoice-table {\n        width: 100%;\n        border-collapse: collapse;\n        margin-bottom: 10px;\n        font-size: 8pt;\n    }\n\n    .invoice-table th {\n        background-color: #1a4d7c;\n        color: white;\n        padding: 5px 4px;\n        text-align: center;\n        font-weight: 600;\n        border: 1px solid #1a4d7c;\n        font-size: 8pt;\n    }\n\n    .invoice-table td {\n        padding: 4px;\n        border: 1px solid #ccc;\n        vertical-align: middle;\n    }\n\n    .invoice-table .text-right {\n        text-align: right;\n    }\n\n    .invoice-table .text-center {\n        text-align: center;\n    }\n\n    .total-row {\n        background-color: #1a4d7c !important;\n        color: white;\n        font-weight: bold;\n    }\n\n    .total-row td {\n        border-color: #1a4d7c !important;\n        padding: 5px 4px;\n        color: white !important;\n    }\n\n    .debit-note-row {\n        background-color: #fff5f5 !important;\n    }\n\n    .debit-note-row td {\n        color: #c0392b;\n    }\n\n    .payment-history-table {\n        width: 100%;\n        border-collapse: collapse;\n        margin-bottom: 10px;\n        font-size: 7pt;\n    }\n\n    .payment-history-table th {\n        background-color: #34495e;\n        color: white;\n        padding: 4px 3px;\n        text-align: center;\n        font-weight: 600;\n        border: 1px solid #34495e;\n        font-size: 7pt;\n    }\n\n    .payment-history-table td {\n        padding: 3px;\n        border: 1px solid #ccc;\n        text-align: center;\n    }\n\n    .signature-section {\n        margin-top: 20px;\n        page-break-inside: avoid;\n    }\n\n    .signature-table {\n        width: 100%;\n        border-collapse: collapse;\n    }\n\n    .signature-table td {\n        width: 50%;\n        padding: 20px 10px 6px 10px;\n        text-align: center;\n        border: 1px solid #ccc;\n        vertical-align: bottom;\n    }\n\n    .signature-line {\n        border-top: 1px solid #333;\n        margin: 0 15px;\n        padding-top: 4px;\n        font-size: 8pt;\n        color: #555;\n    }\n\n    .amount-negative {\n        color: #c0392b;\n    }\n\n    .attachment-section {\n        margin-top: 15px;\n        page-break-before: always;\n    }\n\n    .attachment-content {\n        padding: 5px;\n    }\n\n    .pdf-page-image {\n        max-width: 100%;\n        height: auto;\n        display: block;\n        margin: 5px auto;\n        border: 1px solid #ccc;\n    }\n\n    .po-section {\n        margin-top: 15px;\n        page-break-before: always;\n    }\n\n    .po-header {\n        background-color: #2c3e50;\n        color: white;\n        padding: 8px 12px;\n        font-weight: 600;\n        font-size: 10pt;\n    }\n\n    .po-content {\n        border: 1px solid #ddd;\n        border-top: none;\n        padding: 5px;\n    }\n\n    /* Print specific adjustments */\n    @media print {\n        .print-format {\n            margin: 0;\n            padding: 0;\n        }\n        .page-break {\n            page-break-before: always;\n        }\n    }\n</style>\n\n<div id=\"header-html\" class=\"letter-head-container\">\n    {% if letter_head %}\n        <div class=\"letter-head\">{{ letter_head }}</div>\n    {% endif %}\n</div>\n\n<div class=\"print-format\">\n\n    <!-- Payment Voucher Title -->\n    <div class=\"voucher-title\">PAYMENT VOUCHER</div>\n\n    <!-- Company Row -->\n    <table class=\"company-row\">\n        <tr>\n            <td class=\"label\">Company</td>\n            <td class=\"value\">{{ doc.company }}</td>\n        </tr>\n    </table>\n\n    <!-- Issued Bank Details & Voucher Details -->\n    <table class=\"details-container\">\n        <tr>\n            <td>\n                <div class=\"section-header\">ISSUED BANK DETAILS</div>\n                <table class=\"details-table\">\n                    <tr>\n                        <td class=\"label\">Issued Bank</td>\n                        <td class=\"colon\">:</td>\n                        <td class=\"value\">{{ issued_bank_details.bank or doc.issued_bank or \"\" }}</td>\n                    </tr>\n                    <tr>\n                        <td class=\"label\">Account No.</td>\n                        <td class=\"colon\">:</td>\n                        <td class=\"value\">{{ issued_bank_details.bank_account_no or issued_bank_details.iban or \"\" }}</td>\n                    </tr>\n                    <tr>\n                        <td class=\"label\">Currency</td>\n                        <td class=\"colon\">:</td>\n                        <td class=\"value\">{{ issued_bank_currency }}</td>\n                    </tr>\n                </table>\n            </td>\n            <td>\n                <div class=\"section-header\">VOUCHER DETAILS</div>\n                <table class=\"details-table\">\n                    <tr>\n                        <td class=\"label\">Voucher No.</td>\n                        <td class=\"colon\">:</td>\n                        <td class=\"value\">{{ doc.name }}</td>\n                    </tr>\n                    <tr>\n                        <td class=\"label\">Voucher Date</td>\n                        <td class=\"colon\">:</td>\n                        <td class=\"value\">{{ frappe.utils.formatdate(doc.posting_date, \"d-M-yyyy\") }}</td>\n                    </tr>\n                    <tr>\n                        <td class=\"label\">Payment Mode</td>\n                        <td class=\"colon\">:</td>\n                        <td class=\"value\">{{ doc.payment_mode or \"TR\" }}</td>\n                    </tr>\n                    <tr>\n                        <td class=\"label\">Cheque Date</td>\n                        <td class=\"colon\">:</td>\n                        <td class=\"value\">{{ frappe.utils.formatdate(doc.cheque_date, \"d-M-yyyy\") if doc.cheque_date else \"N/A\" }}</td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n    </table>\n\n    <!-- Supplier Details & Bank Details -->\n    <table class=\"details-container\">\n        <tr>\n            <td>\n                <div class=\"section-header\">SUPPLIER DETAILS</div>\n                <table class=\"details-table\">\n                    <tr>\n                        <td class=\"label\">Supplier Name</td>\n                        <td class=\"colon\">:</td>\n                        <td class=\"value\">{{ party_name }}</td>\n                    </tr>\n                    <tr>\n                        <td class=\"label\">Supplier Address</td>\n                        <td class=\"colon\">:</td>\n                        <td class=\"value\">{{ supplier_address or doc.supplier_address or \"\" }}</td>\n                    </tr>\n                    <tr>\n                        <td class=\"label\">Telephone</td>\n                        <td class=\"colon\">:</td>\n                        <td class=\"value\">{{ supplier_doc.mobile_no or supplier_doc.phone_no or \"\" }}</td>\n                    </tr>\n                    <tr>\n                        <td class=\"label\">E-Mail</td>\n                        <td class=\"colon\">:</td>\n                        <td class=\"value\">{{ supplier_doc.email_id or \"\" }}</td>\n                    </tr>\n                </table>\n            </td>\n            <td>\n                <div class=\"section-header\">BANK DETAILS (for TT/ TR Payments)</div>\n                <table class=\"details-table\">\n                    <tr>\n                        <td class=\"label\">Bank Account No.</td>\n                        <td class=\"colon\">:</td>\n                        <td class=\"value\">{{ supplier_bank.bank_account_no or supplier_bank.iban or \"\" }}</td>\n                    </tr>\n                    <tr>\n                        <td class=\"label\">Bank Account Name</td>\n                        <td class=\"colon\">:</td>\n                        <td class=\"value\">{{ supplier_bank.name or \"\" }}</td>\n                    </tr>\n                    <tr>\n                        <td class=\"label\">Bank Name</td>\n                        <td class=\"colon\">:</td>\n                        <td class=\"value\">{{ supplier_bank.bank or \"\" }}</td>\n                    </tr>\n                    <tr>\n                        <td class=\"label\">SWIFT Code</td>\n                        <td class=\"colon\">:</td>\n                        <td class=\"value\">{{ supplier_swift }}</td>\n                    </tr>\n                </table>\n            </td>\n        </tr>\n    </table>\n\n    <!-- Invoice Summary Section -->\n    <div class=\"section-title\">Invoice Details</div>\n\n    <table class=\"invoice-table\">\n        <thead>\n            <tr>\n                <th style=\"width: 30px;\">SINo</th>\n                <th style=\"width: 120px;\">Inv. No.</th>\n                <th style=\"width: 70px;\">Inv. Date</th>\n                <th style=\"width: 40px;\">Curr.</th>\n                <th style=\"width: 90px;\">Amount (FC)</th>\n                <th style=\"width: 90px;\">Amount ({{ company_currency }})</th>\n                <th>Details / Remarks</th>\n            </tr>\n        </thead>\n        <tbody>\n            {% set total_base = {'value': 0} %}\n            {% set currency_totals = {} %}\n\n            {% for row in doc.payment_references %}\n            {% set is_debit = row.is_return or row.reference_doctype == \"Debit Note\" %}\n            {% set amount_fc = row.outstanding_amount or row.grand_total or 0 %}\n            {% set amount_base = row.base_outstanding_amount or row.base_grand_total or 0 %}\n\n            {% set curr = row.currency or company_currency %}\n            {% if curr not in currency_totals %}\n                {% set _ = currency_totals.update({curr: {'fc': 0, 'base': 0}}) %}\n            {% endif %}\n            {% set _ = currency_totals[curr].update({'fc': currency_totals[curr]['fc'] + amount_fc}) %}\n            {% set _ = total_base.update({'value': total_base['value'] + amount_base}) %}\n\n            <tr class=\"{{ 'debit-note-row' if is_debit else '' }}\">\n                <td class=\"text-center\">{{ loop.index }}</td>\n                <td>{{ row.reference_name }}</td>\n                <td class=\"text-center\">{{ frappe.utils.formatdate(row.invoice_date, \"dd-MM-yyyy\") if row.invoice_date else \"\" }}</td>\n                <td class=\"text-center\">{{ row.currency or company_currency }}</td>\n                <td class=\"text-right {{ 'amount-negative' if is_debit else '' }}\">\n                    {{ frappe.utils.fmt_money(amount_fc, currency=row.currency) }}\n                </td>\n                <td class=\"text-right {{ 'amount-negative' if is_debit else '' }}\">\n                    {{ frappe.utils.fmt_money(amount_base, currency=company_currency) }}\n                </td>\n                <td>{{ row.document_reference or row.remarks or \"\" }}</td>\n            </tr>\n            {% endfor %}\n\n            <tr class=\"total-row\">\n                <td colspan=\"4\" class=\"text-center\"><strong>TOTAL</strong></td>\n                <td class=\"text-right\">\n                    {% for curr, amounts in currency_totals.items() %}\n                    {{ frappe.utils.fmt_money(amounts['fc'], currency=curr) }}{% if not loop.last %}<br>{% endif %}\n                    {% endfor %}\n                </td>\n                <td class=\"text-right\">{{ frappe.utils.fmt_money(total_base['value'], currency=company_currency) }}</td>\n                <td></td>\n            </tr>\n        </tbody>\n    </table>\n\n    <!-- Previous Payment Details Section -->\n    {% if payment_history and payment_history|length > 0 %}\n    <div class=\"section-title\">Previous Payment Details</div>\n\n    <table class=\"payment-history-table\">\n        <thead>\n            <tr>\n                <th style=\"width: 25px;\">Sl.</th>\n                <th style=\"width: 70px;\">Bank</th>\n                <th style=\"width: 25px;\">Type</th>\n                <th style=\"width: 90px;\">Voucher No.</th>\n                <th style=\"width: 60px;\">Date</th>\n                <th style=\"width: 90px;\">Beneficiary</th>\n                <th style=\"width: 90px;\">IBAN/Account</th>\n                <th style=\"width: 70px;\">Debit Account</th>\n                <th style=\"width: 30px;\">Curr.</th>\n                <th style=\"width: 70px;\">Amount</th>\n            </tr>\n        </thead>\n        <tbody>\n            {% for payment in payment_history[:10] %}\n            <tr>\n                <td>{{ loop.index }}</td>\n                <td style=\"text-align: left; padding-left: 3px;\">{{ payment.bank or \"\" }}</td>\n                <td>{{ payment.type or \"TR\" }}</td>\n                <td style=\"text-align: left; padding-left: 3px;\">{{ payment.voucher_no or \"\" }}</td>\n                <td>{{ frappe.utils.formatdate(payment.date, \"dd-MM-yyyy\") if payment.date else \"\" }}</td>\n                <td style=\"text-align: left; padding-left: 3px;\">{{ payment.beneficiary or \"\" }}</td>\n                <td style=\"text-align: left; padding-left: 3px; font-size: 6pt;\">{{ payment.beneficiary_account or \"\" }}</td>\n                <td style=\"text-align: left; padding-left: 3px; font-size: 6pt;\">{{ payment.debit_account or \"\" }}</td>\n                <td>{{ payment.currency or company_currency }}</td>\n                <td style=\"text-align: right;\">{{ frappe.utils.fmt_money(payment.amount, currency=payment.currency) }}</td>\n            </tr>\n            {% endfor %}\n        </tbody>\n    </table>\n    {% endif %}\n\n    <!-- Remarks Section -->\n    {% if doc.remarks %}\n    <div class=\"section-title\">Remarks</div>\n    <div style=\"padding: 6px; background-color: #f9f9f9; border: 1px solid #eee; border-radius: 3px; font-size: 8pt;\">\n        {{ doc.remarks }}\n    </div>\n    {% endif %}\n\n    <!-- Signature Section -->\n    <div class=\"signature-section\">\n        <table class=\"signature-table\">\n            <tr>\n                <td>\n                    <div class=\"signature-line\">Prepared by / Authorized by: ACCOUNTS MANAGER</div>\n                </td>\n                <td>\n                    <div class=\"signature-line\">Approved by: FINANCE MANAGER</div>\n                </td>\n            </tr>\n            <tr>\n                <td>\n                    <div class=\"signature-line\">Approved by: GENERAL MANAGER</div>\n                </td>\n                <td>\n                    <div class=\"signature-line\">Approved by: MANAGING DIRECTOR</div>\n                </td>\n            </tr>\n        </table>\n    </div>\n\n    <!-- Supplier Invoice Attachments and Purchase Orders Section -->\n    {% for row in doc.payment_references %}\n        {% if row.reference_doctype == \"Purchase Invoice\" %}\n            {# Get PDF images from supplier invoice attachment #}\n            {% set pdf_images = frappe.call(\"avientek.avientek.doctype.payment_request_form.payment_request_form.get_invoice_attachment_images\", invoice_name=row.reference_name, max_pages=5) or [] %}\n\n            {# Get linked Purchase Order #}\n            {% set linked_po = frappe.call(\"avientek.avientek.doctype.payment_request_form.payment_request_form.get_linked_po_for_invoice\", invoice_name=row.reference_name) %}\n\n            {# Get Purchase Order print format as images #}\n            {% set po_images = [] %}\n            {% if linked_po %}\n                {% set po_images = frappe.call(\"avientek.avientek.doctype.payment_request_form.payment_request_form.get_print_format_as_images\", doctype=\"Purchase Order\", docname=linked_po, print_format=\"Purchase Order - India\", max_pages=5) or [] %}\n            {% endif %}\n\n            {# Only show section if there are attachments or PO #}\n            {% if pdf_images|length > 0 or po_images|length > 0 %}\n\n            <!-- Supplier Invoice Attachment -->\n            {% if pdf_images|length > 0 %}\n            <div class=\"attachment-section\">\n                <div class=\"section-title\">Supplier Invoice: {{ row.reference_name }}</div>\n                <div class=\"attachment-content\">\n                    {% for img_data in pdf_images %}\n                        <img src=\"{{ img_data }}\" class=\"pdf-page-image\" alt=\"Supplier Invoice Page\" />\n                    {% endfor %}\n                </div>\n            </div>\n            {% endif %}\n\n            <!-- Purchase Order -->\n            {% if po_images|length > 0 %}\n            <div class=\"po-section\">\n                <div class=\"po-header\">Purchase Order: {{ linked_po }}</div>\n                <div class=\"po-content\">\n                    {% for img_data in po_images %}\n                        <img src=\"{{ img_data }}\" class=\"pdf-page-image\" alt=\"Purchase Order Page\" />\n                    {% endfor %}\n                </div>\n            </div>\n            {% endif %}\n\n            {% endif %}\n        {% endif %}\n    {% endfor %}\n</div>\n\n<div id=\"footer-html\" class=\"letter-footer-container\">\n    {% if footer %}\n        <div class=\"letter-footer\">{{ footer }}</div>\n    {% endif %}\n</div>\n",
 "idx": 0,
 "line_breaks": 0,
 "margin_bottom": 15.0,
 "margin_left": 10.0,
 "margin_right": 10.0,
 "margin_top": 15.0,
 "modified": "2026-02-19 08:51:56.057834",
 "modified_by": "Administrator",
 "module": "Avientek",
 "name": "Payment Voucher Professional",
 "owner": "Administrator",
 "print_format_builder": 0,
 "print_format_builder_beta": 0,
 "print_format_type": "Jinja",
 "raw_printing": 0,
 "show_section_headings": 0,
 "standard": "Yes"
}